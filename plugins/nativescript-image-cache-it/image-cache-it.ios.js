"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var common = require("./image-cache-it.common");
var imageSrc = require("image-source");
var view_1 = require("tns-core-modules/ui/core/view");
global.moduleMerge(common, exports);
var ImageCacheIt = (function (_super) {
    __extends(ImageCacheIt, _super);
    function ImageCacheIt() {
        return _super.call(this) || this;
    }
    Object.defineProperty(ImageCacheIt.prototype, "ios", {
        get: function () {
            return this.nativeView;
        },
        enumerable: true,
        configurable: true
    });
    ImageCacheIt.prototype.onMeasure = function (widthMeasureSpec, heightMeasureSpec) {
        var nativeView = this.nativeView;
        if (nativeView) {
            var width = view_1.layout.getMeasureSpecSize(widthMeasureSpec);
            var height = view_1.layout.getMeasureSpecSize(heightMeasureSpec);
            this.setMeasuredDimension(width, height);
        }
    };
    ImageCacheIt.prototype.createNativeView = function () {
        return UIImageView.new();
    };
    ImageCacheIt.prototype.initNativeView = function () {
        var _this = this;
        if (!this.imageUri) {
            return;
        }
        if (this.imageUri.startsWith("http")) {
            this.isLoading = true;
            this.nativeView.sd_setImageWithURLPlaceholderImageCompleted(this.imageUri, this.placeHolder ? imageSrc.fromFileOrResource(this.placeHolder).ios : null, function () {
                _this.isLoading = false;
            });
        }
        else {
            this.nativeView.image = imageSrc.fromFileOrResource(this.imageUri).ios;
        }
        if (this.resize && this.resize !== undefined && this.resize.split(' ').length > 1) {
            this.nativeView.frame.size.width = parseInt(this.resize.split(' ')[0]);
            this.nativeView.frame.size.height = parseInt(this.resize.split(' ')[1]);
        }
        else if (this.override && this.override !== undefined && this.override.split(' ').length > 1) {
            this.nativeView.frame.size.width = parseInt(this.override.split(' ')[0]);
            this.nativeView.frame.size.height = parseInt(this.override.split(' ')[1]);
        }
    };
    ImageCacheIt.prototype[common.imageUriProperty.getDefault] = function () {
        return undefined;
    };
    ImageCacheIt.prototype[common.imageUriProperty.setNative] = function (src) {
        var _this = this;
        if (!this.imageUri) {
            return;
        }
        if (this.imageUri.startsWith("http")) {
            this.isLoading = true;
            this.nativeView.sd_setImageWithURLPlaceholderImageCompleted(this.imageUri, this.placeHolder ? imageSrc.fromFileOrResource(this.placeHolder).ios : null, function () {
                _this.isLoading = false;
            });
        }
        else {
            this.nativeView.image = imageSrc.fromFileOrResource(this.imageUri).ios;
        }
    };
    ImageCacheIt.prototype[common.resizeProperty.setNative] = function (resize) {
        if (this.resize && this.resize !== undefined && this.resize.split(' ').length > 1) {
            this.nativeView.frame.size.width = parseInt(this.resize.split(' ')[0]);
            this.nativeView.frame.size.height = parseInt(this.resize.split(' ')[1]);
        }
    };
    ImageCacheIt.prototype[common.overrideProperty.setNative] = function (override) {
        if (this.override && this.override !== undefined && this.override.split(' ').length > 1) {
            this.nativeView.frame.size.width = parseInt(this.override.split(' ')[0]);
            this.nativeView.frame.size.height = parseInt(this.override.split(' ')[1]);
        }
    };
    ImageCacheIt.prototype[common.stretchProperty.getDefault] = function () {
        return "aspectFit";
    };
    ImageCacheIt.prototype[common.stretchProperty.setNative] = function (value) {
        switch (value) {
            case "aspectFit":
                this.nativeView.contentMode = UIViewContentMode.ScaleAspectFit;
                break;
            case "aspectFill":
                this.nativeView.contentMode = UIViewContentMode.ScaleAspectFill;
                break;
            case "fill":
                this.nativeView.contentMode = UIViewContentMode.ScaleToFill;
                break;
            case "none":
            default:
                this.nativeView.contentMode = UIViewContentMode.TopLeft;
                break;
        }
    };
    ImageCacheIt.prototype.clearItem = function () {
        // this.builder.
    };
    return ImageCacheIt;
}(common.ImageCacheIt));
exports.ImageCacheIt = ImageCacheIt;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW1hZ2UtY2FjaGUtaXQuaW9zLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiaW1hZ2UtY2FjaGUtaXQuaW9zLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsZ0RBQWtEO0FBS2xELHVDQUEwQztBQUMxQyxzREFBNkQ7QUFDN0QsTUFBTSxDQUFDLFdBQVcsQ0FBQyxNQUFNLEVBQUUsT0FBTyxDQUFDLENBQUM7QUFFcEM7SUFBa0MsZ0NBQW1CO0lBR2pEO2VBQ0ksaUJBQU87SUFDWCxDQUFDO0lBRUQsc0JBQUksNkJBQUc7YUFBUDtZQUNJLE1BQU0sQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDO1FBQzNCLENBQUM7OztPQUFBO0lBRU0sZ0NBQVMsR0FBaEIsVUFBaUIsZ0JBQXdCLEVBQUUsaUJBQXlCO1FBQ2hFLElBQU0sVUFBVSxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUM7UUFDbkMsRUFBRSxDQUFDLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQztZQUNiLElBQU0sS0FBSyxHQUFHLGFBQU0sQ0FBQyxrQkFBa0IsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1lBQzFELElBQU0sTUFBTSxHQUFHLGFBQU0sQ0FBQyxrQkFBa0IsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO1lBQzVELElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxLQUFLLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFDN0MsQ0FBQztJQUNMLENBQUM7SUFFTSx1Q0FBZ0IsR0FBdkI7UUFDSSxNQUFNLENBQUMsV0FBVyxDQUFDLEdBQUcsRUFBRSxDQUFDO0lBQzdCLENBQUM7SUFDTSxxQ0FBYyxHQUFyQjtRQUFBLGlCQW9CQztRQW5CRyxFQUFFLENBQUEsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQSxDQUFDO1lBQ2YsTUFBTSxDQUFFO1FBQ1osQ0FBQztRQUNELEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FB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ImltcG9ydCAqIGFzIGNvbW1vbiBmcm9tICcuL2ltYWdlLWNhY2hlLWl0LmNvbW1vbic7XG5pbXBvcnQgYXBwID0gcmVxdWlyZShcImFwcGxpY2F0aW9uXCIpO1xuaW1wb3J0IGZzID0gcmVxdWlyZShcImZpbGUtc3lzdGVtXCIpO1xuaW1wb3J0IHV0aWxzID0gcmVxdWlyZShcInV0aWxzL3V0aWxzXCIpO1xuaW1wb3J0IHR5cGVzID0gcmVxdWlyZShcInV0aWxzL3R5cGVzXCIpO1xuaW1wb3J0IGltYWdlU3JjID0gcmVxdWlyZShcImltYWdlLXNvdXJjZVwiKTtcbmltcG9ydCB7IFZpZXcsIGxheW91dCB9IGZyb20gJ3Rucy1jb3JlLW1vZHVsZXMvdWkvY29yZS92aWV3Jztcbmdsb2JhbC5tb2R1bGVNZXJnZShjb21tb24sIGV4cG9ydHMpO1xuXG5leHBvcnQgY2xhc3MgSW1hZ2VDYWNoZUl0IGV4dGVuZHMgY29tbW9uLkltYWdlQ2FjaGVJdCB7XG4gICAgbmF0aXZlVmlldzogVUlJbWFnZVZpZXc7XG5cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICB9XG5cbiAgICBnZXQgaW9zKCk6IFVJSW1hZ2VWaWV3IHtcbiAgICAgICAgcmV0dXJuIHRoaXMubmF0aXZlVmlldztcbiAgICB9XG4gICAgaXNMb2FkaW5nOiBib29sZWFuO1xuICAgIHB1YmxpYyBvbk1lYXN1cmUod2lkdGhNZWFzdXJlU3BlYzogbnVtYmVyLCBoZWlnaHRNZWFzdXJlU3BlYzogbnVtYmVyKSB7XG4gICAgICAgIGNvbnN0IG5hdGl2ZVZpZXcgPSB0aGlzLm5hdGl2ZVZpZXc7XG4gICAgICAgIGlmIChuYXRpdmVWaWV3KSB7XG4gICAgICAgICAgICBjb25zdCB3aWR0aCA9IGxheW91dC5nZXRNZWFzdXJlU3BlY1NpemUod2lkdGhNZWFzdXJlU3BlYyk7XG4gICAgICAgICAgICBjb25zdCBoZWlnaHQgPSBsYXlvdXQuZ2V0TWVhc3VyZVNwZWNTaXplKGhlaWdodE1lYXN1cmVTcGVjKTtcbiAgICAgICAgICAgIHRoaXMuc2V0TWVhc3VyZWREaW1lbnNpb24od2lkdGgsIGhlaWdodCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgY3JlYXRlTmF0aXZlVmlldygpIHtcbiAgICAgICAgcmV0dXJuIFVJSW1hZ2VWaWV3Lm5ldygpO1xuICAgIH1cbiAgICBwdWJsaWMgaW5pdE5hdGl2ZVZpZXcoKSB7XG4gICAgICAgIGlmKCF0aGlzLmltYWdlVXJpKXtcbiAgICAgICAgICAgIHJldHVybiA7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuaW1hZ2VVcmkuc3RhcnRzV2l0aChcImh0dHBcIikpIHtcbiAgICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgICg8YW55PnRoaXMubmF0aXZlVmlldykuc2Rfc2V0SW1hZ2VXaXRoVVJMUGxhY2Vob2xkZXJJbWFnZUNvbXBsZXRlZCh0aGlzLmltYWdlVXJpLCB0aGlzLnBsYWNlSG9sZGVyID8gaW1hZ2VTcmMuZnJvbUZpbGVPclJlc291cmNlKHRoaXMucGxhY2VIb2xkZXIpLmlvcyA6IG51bGwsICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLm5hdGl2ZVZpZXcuaW1hZ2UgPSBpbWFnZVNyYy5mcm9tRmlsZU9yUmVzb3VyY2UodGhpcy5pbWFnZVVyaSkuaW9zXG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5yZXNpemUgJiYgdGhpcy5yZXNpemUgIT09IHVuZGVmaW5lZCAmJiB0aGlzLnJlc2l6ZS5zcGxpdCgnICcpLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgIHRoaXMubmF0aXZlVmlldy5mcmFtZS5zaXplLndpZHRoID0gcGFyc2VJbnQodGhpcy5yZXNpemUuc3BsaXQoJyAnKVswXSk7XG4gICAgICAgICAgICB0aGlzLm5hdGl2ZVZpZXcuZnJhbWUuc2l6ZS5oZWlnaHQgPSBwYXJzZUludCh0aGlzLnJlc2l6ZS5zcGxpdCgnICcpWzFdKTtcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLm92ZXJyaWRlICYmIHRoaXMub3ZlcnJpZGUgIT09IHVuZGVmaW5lZCAmJiB0aGlzLm92ZXJyaWRlLnNwbGl0KCcgJykubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgdGhpcy5uYXRpdmVWaWV3LmZyYW1lLnNpemUud2lkdGggPSBwYXJzZUludCh0aGlzLm92ZXJyaWRlLnNwbGl0KCcgJylbMF0pO1xuICAgICAgICAgICAgdGhpcy5uYXRpdmVWaWV3LmZyYW1lLnNpemUuaGVpZ2h0ID0gcGFyc2VJbnQodGhpcy5vdmVycmlkZS5zcGxpdCgnICcpWzFdKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBbY29tbW9uLmltYWdlVXJpUHJvcGVydHkuZ2V0RGVmYXVsdF0oKTogYW55IHtcbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG4gICAgW2NvbW1vbi5pbWFnZVVyaVByb3BlcnR5LnNldE5hdGl2ZV0oc3JjOiBzdHJpbmcpIHtcbiAgICAgICAgaWYoIXRoaXMuaW1hZ2VVcmkpe1xuICAgICAgICAgICAgcmV0dXJuIDtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5pbWFnZVVyaS5zdGFydHNXaXRoKFwiaHR0cFwiKSkge1xuICAgICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlO1xuICAgICAgICAgICAgKDxhbnk+dGhpcy5uYXRpdmVWaWV3KS5zZF9zZXRJbWFnZVdpdGhVUkxQbGFjZWhvbGRlckltYWdlQ29tcGxldGVkKHRoaXMuaW1hZ2VVcmksIHRoaXMucGxhY2VIb2xkZXIgPyBpbWFnZVNyYy5mcm9tRmlsZU9yUmVzb3VyY2UodGhpcy5wbGFjZUhvbGRlcikuaW9zIDogbnVsbCwgKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMubmF0aXZlVmlldy5pbWFnZSA9IGltYWdlU3JjLmZyb21GaWxlT3JSZXNvdXJjZSh0aGlzLmltYWdlVXJpKS5pb3NcbiAgICAgICAgfVxuICAgIH1cbiAgICBbY29tbW9uLnJlc2l6ZVByb3BlcnR5LnNldE5hdGl2ZV0ocmVzaXplOiBzdHJpbmcpIHtcbiAgICAgICAgaWYgKHRoaXMucmVzaXplICYmIHRoaXMucmVzaXplICE9PSB1bmRlZmluZWQgJiYgdGhpcy5yZXNpemUuc3BsaXQoJyAnKS5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICB0aGlzLm5hdGl2ZVZpZXcuZnJhbWUuc2l6ZS53aWR0aCA9IHBhcnNlSW50KHRoaXMucmVzaXplLnNwbGl0KCcgJylbMF0pO1xuICAgICAgICAgICAgdGhpcy5uYXRpdmVWaWV3LmZyYW1lLnNpemUuaGVpZ2h0ID0gcGFyc2VJbnQodGhpcy5yZXNpemUuc3BsaXQoJyAnKVsxXSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgW2NvbW1vbi5vdmVycmlkZVByb3BlcnR5LnNldE5hdGl2ZV0ob3ZlcnJpZGU6IHN0cmluZykge1xuICAgICAgICBpZiAodGhpcy5vdmVycmlkZSAmJiB0aGlzLm92ZXJyaWRlICE9PSB1bmRlZmluZWQgJiYgdGhpcy5vdmVycmlkZS5zcGxpdCgnICcpLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgIHRoaXMubmF0aXZlVmlldy5mcmFtZS5zaXplLndpZHRoID0gcGFyc2VJbnQodGhpcy5vdmVycmlkZS5zcGxpdCgnICcpWzBdKTtcbiAgICAgICAgICAgIHRoaXMubmF0aXZlVmlldy5mcmFtZS5zaXplLmhlaWdodCA9IHBhcnNlSW50KHRoaXMub3ZlcnJpZGUuc3BsaXQoJyAnKVsxXSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBbY29tbW9uLnN0cmV0Y2hQcm9wZXJ0eS5nZXREZWZhdWx0XSgpOiBcImFzcGVjdEZpdFwiIHtcbiAgICAgICAgcmV0dXJuIFwiYXNwZWN0Rml0XCI7XG4gICAgfVxuICAgIFtjb21tb24uc3RyZXRjaFByb3BlcnR5LnNldE5hdGl2ZV0odmFsdWU6IFwibm9uZVwiIHwgXCJhc3BlY3RGaWxsXCIgfCBcImFzcGVjdEZpdFwiIHwgXCJmaWxsXCIpIHtcbiAgICAgICAgc3dpdGNoICh2YWx1ZSkge1xuICAgICAgICAgICAgY2FzZSBcImFzcGVjdEZpdFwiOlxuICAgICAgICAgICAgICAgIHRoaXMubmF0aXZlVmlldy5jb250ZW50TW9kZSA9IFVJVmlld0NvbnRlbnRNb2RlLlNjYWxlQXNwZWN0Rml0O1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcImFzcGVjdEZpbGxcIjpcbiAgICAgICAgICAgICAgICB0aGlzLm5hdGl2ZVZpZXcuY29udGVudE1vZGUgPSBVSVZpZXdDb250ZW50TW9kZS5TY2FsZUFzcGVjdEZpbGw7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiZmlsbFwiOlxuICAgICAgICAgICAgICAgIHRoaXMubmF0aXZlVmlldy5jb250ZW50TW9kZSA9IFVJVmlld0NvbnRlbnRNb2RlLlNjYWxlVG9GaWxsO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcIm5vbmVcIjpcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgdGhpcy5uYXRpdmVWaWV3LmNvbnRlbnRNb2RlID0gVUlWaWV3Q29udGVudE1vZGUuVG9wTGVmdDtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuXG4gICAgfVxuXG4gICAgcHVibGljIGNsZWFySXRlbSgpIHtcbiAgICAgICAgLy8gdGhpcy5idWlsZGVyLlxuICAgIH1cbn0iXX0=